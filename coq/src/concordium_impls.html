<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-06 Thu 12:23 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Concordium Smartcontract Infrastructure Implementations</title>
<meta name="author" content="Lasse Letager Hansen" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<style>pre.src {background-color: #303030; color: #e5e5e5;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Concordium Smartcontract Infrastructure Implementations</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org3559763">1. Concordium "Impls" specification</a>
<ul>
<li><a href="#orgcb2e017">1.1. Config</a></li>
<li><a href="#org24b869e">1.2. Imports</a></li>
<li><a href="#org240e46d">1.3. Rust code</a>
<ul>
<li><a href="#org28274e5">1.3.1. Reject</a></li>
<li><a href="#org88fe0ea">1.3.2. Contract state</a></li>
<li><a href="#orged9fe39">1.3.3. Parameter</a></li>
<li><a href="#orgd6c64f2">1.3.4. AttributesCursor</a></li>
</ul>
</li>
<li><a href="#orgbf4a7f1">1.4. Rust Tests</a></li>
<li><a href="#orgadc6d21">1.5. Resulting output</a></li>
<li><a href="#orgff24c33">1.6. Generation of backend output</a>
<ul>
<li><a href="#org38ab639">1.6.1. The includes</a></li>
<li><a href="#org427d530">1.6.2. Types and default implementations</a></li>
<li><a href="#orga7ee377">1.6.3. Error handling</a></li>
<li><a href="#org460e005">1.6.4. Contract state</a></li>
<li><a href="#org4a6120a">1.6.5. Parameter</a></li>
<li><a href="#orgbd414e3">1.6.6. Attributes Cursor</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org3559763" class="outline-2">
<h2 id="org3559763"><span class="section-number-2">1.</span> Concordium "Impls" specification</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgcb2e017" class="outline-3">
<h3 id="orgcb2e017"><span class="section-number-3">1.1.</span> Config</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-toml">[<span style="color: #00ff00;">package</span>]
<span style="color: #9acd32;">name</span> = <span style="color: #bdb76b;">"concordium_impls"</span>
<span style="color: #9acd32;">version</span> = <span style="color: #bdb76b;">"0.1.0"</span>
<span style="color: #9acd32;">authors</span> = [<span style="color: #bdb76b;">""</span>]
<span style="color: #9acd32;">edition</span> = <span style="color: #bdb76b;">"2018"</span>

[<span style="color: #00ff00;">lib</span>]
<span style="color: #9acd32;">path</span> = <span style="color: #bdb76b;">"src/concordium_impls.rs"</span>

[<span style="color: #00ff00;">dependencies</span>]
<span style="color: #9acd32;">hacspec-lib</span> = { path = <span style="color: #bdb76b;">"../../lib"</span> }
<span style="color: #9acd32;">hacspec-attributes</span> = { path = <span style="color: #bdb76b;">"../../utils/attributes"</span>, version = <span style="color: #bdb76b;">"0.1.0-beta.1"</span> , features = [<span style="color: #bdb76b;">"print_attributes"</span>, <span style="color: #bdb76b;">"hacspec_unsafe"</span>] } <span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">, features = ["hacspec_unsafe"] , , optional = true</span>
<span style="color: #7f7f7f;"># </span><span style="color: #7f7f7f;">pearlite-syn = { path = "../../../../creusot/pearlite-syn" }</span>
<span style="color: #9acd32;">creusot-contracts</span> = { path = <span style="color: #bdb76b;">"../../../../creusot/creusot-contracts"</span> }

[<span style="color: #00ff00;">features</span>]
<span style="color: #9acd32;">use_attributes</span> = [<span style="color: #bdb76b;">"hacspec-attributes/print_attributes"</span>, <span style="color: #bdb76b;">"hacspec-attributes/hacspec_unsafe"</span>]

[<span style="color: #00ff00;">dev-dependencies</span>]
<span style="color: #9acd32;">hacspec-dev</span> = { path = <span style="color: #bdb76b;">"../../utils/dev"</span> }
<span style="color: #9acd32;">criterion</span> = <span style="color: #bdb76b;">"0.3"</span>
<span style="color: #9acd32;">rand</span> = <span style="color: #bdb76b;">"0.8"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org24b869e" class="outline-3">
<h3 id="org24b869e"><span class="section-number-3">1.2.</span> Imports</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">not</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"hacspec"</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">extern</span> <span style="color: #b3b3b3;">crate</span> hacspec_lib;

<span style="color: #b3b3b3;">use</span> <span style="color: #87ceeb;">hacspec_lib</span>::*;

<span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">#[cfg(feature = "hacspec_attributes")]</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"hacspec"</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">use</span> <span style="color: #87ceeb;">hacspec_attributes</span>::*;

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">not</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"hacspec"</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">extern</span> <span style="color: #b3b3b3;">crate</span> creusot_contracts;
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">not</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"hacspec"</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">use</span> <span style="color: #87ceeb;">creusot_contracts</span>::*;
</pre>
</div>
</div>
</div>

<div id="outline-container-org240e46d" class="outline-3">
<h3 id="org240e46d"><span class="section-number-3">1.3.</span> Rust code</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-org28274e5" class="outline-4">
<h4 id="org28274e5"><span class="section-number-4">1.3.1.</span> Reject</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
We modle reject as the underlying data, that is the error code. The default constructor is i32 min.
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">type</span> <span style="color: #00ff00;">Reject</span> = <span style="color: #00ff00;">i32</span>;

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">reject_impl_deafult</span><span style="color: #7d26cd;">()</span> -&gt; <span style="color: #00ff00;">Reject</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span>
<span style="color: #7d26cd;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-rust"><span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">type</span> <span style="color: #00ff00;">OptionReject</span> = <span style="color: #00ff00;">Option</span><span style="color: #7d26cd;">&lt;</span><span style="color: #00ff00;">Reject</span><span style="color: #7d26cd;">&gt;</span>;

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">new_reject_impl</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">x</span>: <span style="color: #00ff00;">i32</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">OptionReject</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">if</span> x &lt; 0i32 <span style="color: #cd0000;">{</span>
        <span style="color: #00ff00;">OptionReject</span>::<span style="color: #00ff00;">Some</span><span style="color: #cd8500;">(</span>x<span style="color: #cd8500;">)</span>
    <span style="color: #cd0000;">}</span> <span style="color: #b3b3b3;">else</span> <span style="color: #cd0000;">{</span>
        <span style="color: #00ff00;">Option</span>::<span style="color: #cd8500;">&lt;</span><span style="color: #00ff00;">i32</span><span style="color: #cd8500;">&gt;</span>::<span style="color: #00ff00;">None</span> <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">OptionReject</span>
    <span style="color: #cd0000;">}</span>
<span style="color: #7d26cd;">}</span>

</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="orga185296"></a>Reject - From trait<br />
<div class="outline-text-5" id="text-1-3-1-1">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #b3b3b3;">impl</span> <span style="color: #87ceeb;">convert</span>::<span style="color: #00ff00;">From</span><span style="color: #7d26cd;">&lt;</span><span style="color: #cd0000;">()</span><span style="color: #7d26cd;">&gt;</span> <span style="color: #b3b3b3;">for</span> <span style="color: #00ff00;">Reject</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #4169e1;">#</span><span style="color: #cd0000;">[</span><span style="color: #4169e1;">inline</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">always</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">]</span>
    <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">from</span><span style="color: #cd0000;">(</span><span style="color: #9acd32;">_</span>: <span style="color: #cd8500;">()</span><span style="color: #cd0000;">)</span> -&gt; <span style="color: #00ff00;">Self</span> <span style="color: #cd0000;">{</span>
        <span style="color: #00ff00;">Reject</span> <span style="color: #cd8500;">{</span>
            <span style="color: #9acd32;">error_code</span>: <span style="color: #ff8c69;">unsafe</span> <span style="color: #cdcd00;">{</span> <span style="color: #87ceeb;">num</span>::<span style="color: #00ff00;">NonZeroI32</span>::new_unchecked<span style="color: #00cd00;">(</span><span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 1<span style="color: #00cd00;">)</span> <span style="color: #cdcd00;">}</span>,
        <span style="color: #cd8500;">}</span>
    <span style="color: #cd0000;">}</span>
<span style="color: #7d26cd;">}</span>

<span style="color: #b3b3b3;">impl</span> <span style="color: #87ceeb;">convert</span>::<span style="color: #00ff00;">From</span><span style="color: #7d26cd;">&lt;</span><span style="color: #00ff00;">ParseError</span><span style="color: #7d26cd;">&gt;</span> <span style="color: #b3b3b3;">for</span> <span style="color: #00ff00;">Reject</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #4169e1;">#</span><span style="color: #cd0000;">[</span><span style="color: #4169e1;">inline</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">always</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">]</span>
    <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">from</span><span style="color: #cd0000;">(</span><span style="color: #9acd32;">_</span>: <span style="color: #00ff00;">ParseError</span><span style="color: #cd0000;">)</span> -&gt; <span style="color: #00ff00;">Self</span> <span style="color: #cd0000;">{</span>
        <span style="color: #00ff00;">Reject</span> <span style="color: #cd8500;">{</span>
            <span style="color: #9acd32;">error_code</span>: <span style="color: #ff8c69;">unsafe</span> <span style="color: #cdcd00;">{</span> <span style="color: #87ceeb;">num</span>::<span style="color: #00ff00;">NonZeroI32</span>::new_unchecked<span style="color: #00cd00;">(</span><span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 2<span style="color: #00cd00;">)</span> <span style="color: #cdcd00;">}</span>,
        <span style="color: #cd8500;">}</span>
    <span style="color: #cd0000;">}</span>
<span style="color: #7d26cd;">}</span>
</pre>
</div>

<p>
We modle the unsafe block with unchecked non zero as a precondition using requires giving us the hacspec equivalent
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">ensures</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">result != 0i32</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">reject_impl_convert_from_unit</span><span style="color: #7d26cd;">()</span> -&gt; <span style="color: #00ff00;">Reject</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 1i32
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">ensures</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">result != 0i32</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">reject_impl_convert_from_parse_error</span><span style="color: #7d26cd;">()</span> -&gt; <span style="color: #00ff00;">Reject</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 2i32
<span style="color: #7d26cd;">}</span>
</pre>
</div>
<p>
which we can insert as the definition of the from functions in the trait implementation by using a coerce function
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">coerce_hacspec_to_rust_reject</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">hacspec_reject</span>: <span style="color: #00ff00;">ConcordiumImpls</span>::<span style="color: #00ff00;">Reject</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #00ff00;">Reject</span> <span style="color: #cd0000;">{</span>
        <span style="color: #9acd32;">error_code</span>: hacspec_reject,
    <span style="color: #cd0000;">}</span>
<span style="color: #7d26cd;">}</span>
</pre>
</div>
<p>
We define a log error type and function converting from it to the reject type
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: light orange;">/// Errors that can occur during logging.</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">derive</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">Copy, Clone</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span> <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">, Debug, Eq, PartialEq</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">repr</span><span style="color: #cd0000;">(</span><span style="color: #00ff00;">u8</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">enum</span> <span style="color: #00ff00;">LogError</span> <span style="color: #7d26cd;">{</span>
    <span style="color: light orange;">/// The log is full.</span>
    <span style="color: #00ff00;">Full</span>,
    <span style="color: light orange;">/// The message to log was malformed (e.g., too long)</span>
    <span style="color: #00ff00;">Malformed</span>,
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">ensures</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">result != 0i32</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">reject_impl_from_log_error</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">le</span>: <span style="color: #00ff00;">LogError</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">Reject</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">match</span> le <span style="color: #cd0000;">{</span>
        <span style="color: #00ff00;">LogError</span>::<span style="color: #00ff00;">Full</span> =&gt; <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 3i32,
        <span style="color: #00ff00;">LogError</span>::<span style="color: #00ff00;">Malformed</span> =&gt; <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 4i32,
    <span style="color: #cd0000;">}</span>
<span style="color: #7d26cd;">}</span>

</pre>
</div>
<p>
We define a type for new contract name errors and conversion from it to reject
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">derive</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">Clone</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span> <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">, Debug, PartialEq, Eq</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">enum</span> <span style="color: #00ff00;">NewContractNameError</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #00ff00;">NewContractNameErrorMissingInitPrefix</span>,
    <span style="color: #00ff00;">NewContractNameErrorTooLong</span>,
    <span style="color: #00ff00;">NewContractNameErrorContainsDot</span>,
    <span style="color: #00ff00;">NewContractNameErrorInvalidCharacters</span>,
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">ensures</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">result != 0i32</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">reject_impl_from_new_contract_name_error</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">nre</span>: <span style="color: #00ff00;">NewContractNameError</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">Reject</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">match</span> nre <span style="color: #cd0000;">{</span>
        <span style="color: #00ff00;">NewContractNameError</span>::<span style="color: #00ff00;">NewContractNameErrorMissingInitPrefix</span> =&gt; <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 5i32,
        <span style="color: #00ff00;">NewContractNameError</span>::<span style="color: #00ff00;">NewContractNameErrorTooLong</span> =&gt; <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 6i32,
        <span style="color: #00ff00;">NewContractNameError</span>::<span style="color: #00ff00;">NewContractNameErrorContainsDot</span> =&gt; <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 9i32,
        <span style="color: #00ff00;">NewContractNameError</span>::<span style="color: #00ff00;">NewContractNameErrorInvalidCharacters</span> =&gt; <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 10i32,
    <span style="color: #cd0000;">}</span>
<span style="color: #7d26cd;">}</span>

</pre>
</div>
<p>
We define a type for new receive name errors and conversion from it to reject
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">derive</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">Clone</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span> <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">, Debug, PartialEq, Eq</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">enum</span> <span style="color: #00ff00;">NewReceiveNameError</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #00ff00;">NewReceiveNameErrorMissingDotSeparator</span>,
    <span style="color: #00ff00;">NewReceiveNameErrorTooLong</span>,
    <span style="color: #00ff00;">NewReceiveNameErrorInvalidCharacters</span>,
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">ensures</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">result != 0i32</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">reject_impl_from_new_receive_name_error</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">nre</span>: <span style="color: #00ff00;">NewReceiveNameError</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">Reject</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">match</span> nre <span style="color: #cd0000;">{</span>
        <span style="color: #00ff00;">NewReceiveNameError</span>::<span style="color: #00ff00;">NewReceiveNameErrorMissingDotSeparator</span> =&gt; <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 7i32,
        <span style="color: #00ff00;">NewReceiveNameError</span>::<span style="color: #00ff00;">NewReceiveNameErrorTooLong</span> =&gt; <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 8i32,
        <span style="color: #00ff00;">NewReceiveNameError</span>::<span style="color: #00ff00;">NewReceiveNameErrorInvalidCharacters</span> =&gt; <span style="color: #00ff00;">i32</span>::<span style="color: #00ff00;">MIN</span> + 11i32,
    <span style="color: #cd0000;">}</span>
<span style="color: #7d26cd;">}</span>

</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org88fe0ea" class="outline-4">
<h4 id="org88fe0ea"><span class="section-number-4">1.3.2.</span> Contract state</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
We define contract state as its inner state namely the current position of the type.
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">type</span> <span style="color: #00ff00;">ContractState</span> = <span style="color: #00ff00;">u32</span>;

</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org6df5143"></a>Contract State &#x2013; Seek<br />
<div class="outline-text-5" id="text-1-3-2-1">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">type</span> <span style="color: #00ff00;">SeekResult</span> = <span style="color: #00ff00;">Result</span><span style="color: #7d26cd;">&lt;</span><span style="color: #cd0000;">(</span><span style="color: #00ff00;">ContractState</span>, <span style="color: #00ff00;">u64</span><span style="color: #cd0000;">)</span>, <span style="color: #cd0000;">()</span><span style="color: #7d26cd;">&gt;</span>;

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">derive</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">Copy, Clone</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span> <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">, Debug, PartialEq, Eq</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">enum</span> <span style="color: #00ff00;">SeekFrom</span> <span style="color: #7d26cd;">{</span>
    <span style="color: light orange;">/// Sets the offset to the provided number of bytes.</span>
    <span style="color: #00ff00;">Start</span><span style="color: #cd0000;">(</span><span style="color: #00ff00;">u64</span><span style="color: #cd0000;">)</span>,

    <span style="color: light orange;">/// Sets the offset to the size of this object plus the specified number of</span>
    <span style="color: light orange;">/// bytes.</span>
    <span style="color: light orange;">///</span>
    <span style="color: light orange;">/// It is possible to seek beyond the end of an object, but it's an error to</span>
    <span style="color: light orange;">/// seek before byte 0.</span>
    <span style="color: #00ff00;">End</span><span style="color: #cd0000;">(</span><span style="color: #00ff00;">i64</span><span style="color: #cd0000;">)</span>,

    <span style="color: light orange;">/// Sets the offset to the current position plus the specified number of</span>
    <span style="color: light orange;">/// bytes.</span>
    <span style="color: light orange;">///</span>
    <span style="color: light orange;">/// It is possible to seek beyond the end of an object, but it's an error to</span>
    <span style="color: light orange;">/// seek before byte 0.</span>
    <span style="color: #00ff00;">Current</span><span style="color: #cd0000;">(</span><span style="color: #00ff00;">i64</span><span style="color: #cd0000;">)</span>,
<span style="color: #7d26cd;">}</span>

<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">type</span> <span style="color: #00ff00;">U32Option</span> = <span style="color: #00ff00;">Option</span><span style="color: #7d26cd;">&lt;</span><span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">&gt;</span>;
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">type</span> <span style="color: #00ff00;">I64Option</span> = <span style="color: #00ff00;">Option</span><span style="color: #7d26cd;">&lt;</span><span style="color: #00ff00;">i64</span><span style="color: #7d26cd;">&gt;</span>;

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, trusted</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">requires</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">forall</span><span style="color: #cd8500;">&lt;</span><span style="color: #4169e1;">delta : </span><span style="color: #00ff00;">i64</span><span style="color: #cd8500;">&gt;</span><span style="color: #4169e1;"> pos === SeekFrom::End</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">delta</span><span style="color: #cd8500;">)</span><span style="color: #4169e1;"> ==&gt; exists&lt;b : </span><span style="color: #00ff00;">u32</span><span style="color: #4169e1;">&gt; current_position.checked_add</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">delta </span><span style="color: #b3b3b3;">as</span><span style="color: #4169e1;"> </span><span style="color: #00ff00;">u32</span><span style="color: #cd8500;">)</span><span style="color: #4169e1;"> == U32Option::Some</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">b</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">contract_state_impl_seek</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position</span>: <span style="color: #00ff00;">ContractState</span>, <span style="color: #9acd32;">pos</span>: <span style="color: #00ff00;">SeekFrom</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">SeekResult</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">match</span> pos <span style="color: #cd0000;">{</span>
        <span style="color: #00ff00;">SeekFrom</span>::<span style="color: #00ff00;">Start</span><span style="color: #cd8500;">(</span>offset<span style="color: #cd8500;">)</span> =&gt; <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Ok</span><span style="color: #cd8500;">(</span><span style="color: #cdcd00;">(</span>offset <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u32</span>, offset<span style="color: #cdcd00;">)</span><span style="color: #cd8500;">)</span>,
        <span style="color: #00ff00;">SeekFrom</span>::<span style="color: #00ff00;">End</span><span style="color: #cd8500;">(</span>delta<span style="color: #cd8500;">)</span> =&gt; <span style="color: #cd8500;">{</span>
            <span style="color: #b3b3b3;">if</span> delta &gt;= 0_i64 <span style="color: #cdcd00;">{</span>
                <span style="color: #b3b3b3;">match</span> current_position.checked_add<span style="color: #00cd00;">(</span>delta <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u32</span><span style="color: #00cd00;">)</span> <span style="color: #00cd00;">{</span>
                    <span style="color: #00ff00;">U32Option</span>::<span style="color: #00ff00;">Some</span><span style="color: #00cdcd;">(</span>b<span style="color: #00cdcd;">)</span> =&gt; <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Ok</span><span style="color: #00cdcd;">(</span><span style="color: #0000cd;">(</span>b, delta <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u64</span><span style="color: #0000cd;">)</span><span style="color: #00cdcd;">)</span>,
                    <span style="color: #00ff00;">U32Option</span>::<span style="color: #00ff00;">None</span> =&gt; <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Err</span><span style="color: #00cdcd;">(</span><span style="color: #0000cd;">()</span><span style="color: #00cdcd;">)</span>,
                <span style="color: #00cd00;">}</span>
            <span style="color: #cdcd00;">}</span> <span style="color: #b3b3b3;">else</span> <span style="color: #cdcd00;">{</span>
                <span style="color: #b3b3b3;">match</span> delta.checked_abs<span style="color: #00cd00;">()</span> <span style="color: #00cd00;">{</span>
                    <span style="color: #00ff00;">I64Option</span>::<span style="color: #00ff00;">Some</span><span style="color: #00cdcd;">(</span>b<span style="color: #00cdcd;">)</span> =&gt;
                    <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">{</span>
                    <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">let new_pos = 4_u32 - (b as u32);</span>
                    <span style="color: #00cdcd;">{</span>
                        <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Ok</span><span style="color: #0000cd;">(</span><span style="color: #cd00cd;">(</span><span style="color: #cd1076;">(</span>4_u32 - <span style="color: #7d26cd;">(</span>b <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span><span style="color: #cd1076;">)</span>, <span style="color: #cd1076;">(</span>4_u32 - <span style="color: #7d26cd;">(</span>b <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span><span style="color: #cd1076;">)</span> <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u64</span><span style="color: #cd00cd;">)</span><span style="color: #0000cd;">)</span>
                    <span style="color: #00cdcd;">}</span>
                    <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">}</span>
                    <span style="color: #00ff00;">I64Option</span>::<span style="color: #00ff00;">None</span> =&gt; <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Err</span><span style="color: #00cdcd;">(</span><span style="color: #0000cd;">()</span><span style="color: #00cdcd;">)</span>,
                <span style="color: #00cd00;">}</span>
            <span style="color: #cdcd00;">}</span>
        <span style="color: #cd8500;">}</span>
        <span style="color: #00ff00;">SeekFrom</span>::<span style="color: #00ff00;">Current</span><span style="color: #cd8500;">(</span>delta<span style="color: #cd8500;">)</span> =&gt; <span style="color: #cd8500;">{</span>
            <span style="color: #b3b3b3;">if</span> delta &gt;= 0_i64 <span style="color: #cdcd00;">{</span>
                <span style="color: #b3b3b3;">match</span> current_position.checked_add<span style="color: #00cd00;">(</span>delta <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u32</span><span style="color: #00cd00;">)</span> <span style="color: #00cd00;">{</span>
                    <span style="color: #00ff00;">U32Option</span>::<span style="color: #00ff00;">Some</span><span style="color: #00cdcd;">(</span>offset<span style="color: #00cdcd;">)</span> =&gt; <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Ok</span><span style="color: #00cdcd;">(</span><span style="color: #0000cd;">(</span>offset, offset <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u64</span><span style="color: #0000cd;">)</span><span style="color: #00cdcd;">)</span>,
                    <span style="color: #00ff00;">U32Option</span>::<span style="color: #00ff00;">None</span> =&gt; <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Err</span><span style="color: #00cdcd;">(</span><span style="color: #0000cd;">()</span><span style="color: #00cdcd;">)</span>,
                <span style="color: #00cd00;">}</span>
            <span style="color: #cdcd00;">}</span> <span style="color: #b3b3b3;">else</span> <span style="color: #cdcd00;">{</span>
                <span style="color: #b3b3b3;">match</span> delta.checked_abs<span style="color: #00cd00;">()</span> <span style="color: #00cd00;">{</span>
                    <span style="color: #00ff00;">I64Option</span>::<span style="color: #00ff00;">Some</span><span style="color: #00cdcd;">(</span>b<span style="color: #00cdcd;">)</span> =&gt; <span style="color: #b3b3b3;">match</span> current_position.checked_sub<span style="color: #00cdcd;">(</span>b <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u32</span><span style="color: #00cdcd;">)</span> <span style="color: #00cdcd;">{</span>
                        <span style="color: #00ff00;">U32Option</span>::<span style="color: #00ff00;">Some</span><span style="color: #0000cd;">(</span>offset<span style="color: #0000cd;">)</span> =&gt; <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Ok</span><span style="color: #0000cd;">(</span><span style="color: #cd00cd;">(</span>offset, offset <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u64</span><span style="color: #cd00cd;">)</span><span style="color: #0000cd;">)</span>,
                        <span style="color: #00ff00;">U32Option</span>::<span style="color: #00ff00;">None</span> =&gt; <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Err</span><span style="color: #0000cd;">(</span><span style="color: #cd00cd;">()</span><span style="color: #0000cd;">)</span>,
                    <span style="color: #00cdcd;">}</span>,
                    <span style="color: #00ff00;">I64Option</span>::<span style="color: #00ff00;">None</span> =&gt; <span style="color: #00ff00;">SeekResult</span>::<span style="color: #00ff00;">Err</span><span style="color: #00cdcd;">(</span><span style="color: #0000cd;">()</span><span style="color: #00cdcd;">)</span>,
                <span style="color: #00cd00;">}</span>
            <span style="color: #cdcd00;">}</span>
        <span style="color: #cd8500;">}</span>
    <span style="color: #cd0000;">}</span>
<span style="color: #7d26cd;">}</span>
</pre>
</div>
</div>
</li>
<li><a id="org61ee22d"></a>Contract State &#x2013; Load<br />
<div class="outline-text-5" id="text-1-3-2-2">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">not</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"hacspec"</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">extern</span> <span style="color: #bdb76b;">"C"</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">pub</span><span style="color: #cd0000;">(</span><span style="color: #b3b3b3;">crate</span><span style="color: #cd0000;">)</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">load_state</span><span style="color: #cd0000;">(</span><span style="color: #9acd32;">start</span>: *<span style="color: #b3b3b3;">mut</span> <span style="color: #00ff00;">u8</span>, <span style="color: #9acd32;">length</span>: <span style="color: #00ff00;">u32</span>, <span style="color: #9acd32;">offset</span>: <span style="color: #00ff00;">u32</span><span style="color: #cd0000;">)</span> -&gt; <span style="color: #00ff00;">u32</span>;
<span style="color: #7d26cd;">}</span>

<span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">#[cfg(feature = "hacspec")]</span>
<span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">#[cfg_attr(feature = "creusot", trusted)]</span>
<span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">#[requires(offset &lt; buf.len())]</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"hacspec"</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">ensures</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">result != </span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">buf, 2u32</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span> <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">forall&lt;b : u32&gt; result = (buf,b) ==&gt; 0u32 &lt; offset + b</span>
<span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">load_state_hacspec</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">buf</span> : <span style="color: #00ff00;">PublicByteSeq</span>, <span style="color: #9acd32;">offset</span>: <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">PublicByteSeq</span>, <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #cd0000;">(</span>buf, 1u32<span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">not</span><span style="color: #cd8500;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"hacspec"</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">load_state_hacspec</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">buf</span> : <span style="color: #00ff00;">PublicByteSeq</span>, <span style="color: #9acd32;">offset</span>: <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">PublicByteSeq</span>, <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">let</span> <span style="color: #b3b3b3;">mut</span> <span style="color: #9acd32;">temp_vec</span> : <span style="color: #00ff00;">Vec</span><span style="color: #cd0000;">&lt;</span><span style="color: #00ff00;">u8</span><span style="color: #cd0000;">&gt;</span> = <span style="color: #cd0000;">(</span>0..buf.len<span style="color: #cd8500;">()</span><span style="color: #cd0000;">)</span>.map<span style="color: #cd0000;">(</span>|i| <span style="color: #cd8500;">{</span>
        buf.index<span style="color: #cdcd00;">(</span>i<span style="color: #cdcd00;">)</span>.clone<span style="color: #cdcd00;">()</span>
    <span style="color: #cd8500;">}</span><span style="color: #cd0000;">)</span>.collect<span style="color: #cd0000;">()</span>;
    <span style="color: #b3b3b3;">let</span> <span style="color: #9acd32;">temp</span> = &amp;<span style="color: #b3b3b3;">mut</span> temp_vec<span style="color: #cd0000;">[</span>..<span style="color: #cd0000;">]</span>;
    <span style="color: #b3b3b3;">let</span> <span style="color: #9acd32;">i</span> = <span style="color: #ff8c69;">unsafe</span> <span style="color: #cd0000;">{</span> load_state<span style="color: #cd8500;">(</span>temp.as_mut_ptr<span style="color: #cdcd00;">()</span>, buf.len<span style="color: #cdcd00;">()</span> <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">u32</span>, offset<span style="color: #cd8500;">)</span> <span style="color: #cd0000;">}</span>;
    <span style="color: #cd0000;">(</span><span style="color: #00ff00;">PublicByteSeq</span>::from_native_slice<span style="color: #cd8500;">(</span>temp<span style="color: #cd8500;">)</span>, i<span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>

</pre>
</div>
</div>
</li>
<li><a id="org5558ce8"></a>Contract State &#x2013; Read<br />
<div class="outline-text-5" id="text-1-3-2-3">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, trusted</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">contract_state_impl_read_read</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">current_position</span>: <span style="color: #00ff00;">ContractState</span>,
    <span style="color: #9acd32;">buf</span> : <span style="color: #00ff00;">PublicByteSeq</span> <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">Seq&lt;u8&gt;</span>
    <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">num_read: u32,</span>
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">ContractState</span>, <span style="color: #00ff00;">usize</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">let</span> <span style="color: #cd0000;">(</span>buf, num_read<span style="color: #cd0000;">)</span> = load_state_hacspec<span style="color: #cd0000;">(</span>buf, current_position<span style="color: #cd0000;">)</span>;
    <span style="color: #cd0000;">(</span>current_position + num_read, num_read <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">usize</span><span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>

<span style="color: light orange;">/// Read a u32 in little-endian format. This is optimized to not</span>
<span style="color: light orange;">/// initialize a dummy value before calling an external function.</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">contract_state_impl_read_read_u64</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">current_position</span>: <span style="color: #00ff00;">ContractState</span>,
    <span style="color: #9acd32;">num_read</span>: <span style="color: #00ff00;">u32</span>,
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">ContractState</span>, <span style="color: #00ff00;">bool</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #cd0000;">(</span>current_position + num_read, num_read == 8_u32<span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>

<span style="color: light orange;">/// Read a u32 in little-endian format. This is optimized to not</span>
<span style="color: light orange;">/// initialize a dummy value before calling an external function.</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">contract_state_impl_read_read_u32</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">current_position</span>: <span style="color: #00ff00;">ContractState</span>,
    <span style="color: #9acd32;">num_read</span>: <span style="color: #00ff00;">u32</span>,
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">ContractState</span>, <span style="color: #00ff00;">bool</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #cd0000;">(</span>current_position + num_read, num_read == 4_u32<span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>

<span style="color: light orange;">/// Read a u8 in little-endian format. This is optimized to not</span>
<span style="color: light orange;">/// initialize a dummy value before calling an external function.</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">contract_state_impl_read_read_u8</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">current_position</span>: <span style="color: #00ff00;">ContractState</span>,
    <span style="color: #9acd32;">num_read</span>: <span style="color: #00ff00;">u32</span>,
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">ContractState</span>, <span style="color: #00ff00;">bool</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #cd0000;">(</span>current_position + num_read, num_read == 1_u32<span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>

</pre>
</div>
</div>
</li>
<li><a id="org9bd2d2c"></a>Contract State &#x2013; Write<br />
<div class="outline-text-5" id="text-1-3-2-4">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">write_impl_for_contract_state_test</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position</span>: <span style="color: #00ff00;">ContractState</span>, <span style="color: #9acd32;">len</span>: <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">bool</span> <span style="color: #7d26cd;">{</span>
    current_position.checked_add<span style="color: #cd0000;">(</span>len<span style="color: #cd0000;">)</span>.is_none<span style="color: #cd0000;">()</span> <span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">Check for overflow</span>
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, trusted</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">write_impl_for_contract_state</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">current_position</span>: <span style="color: #00ff00;">ContractState</span>,
    <span style="color: #9acd32;">num_bytes</span>: <span style="color: #00ff00;">u32</span>,
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">ContractState</span>, <span style="color: #00ff00;">usize</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #cd0000;">(</span>current_position + num_bytes, num_bytes <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">usize</span><span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>

</pre>
</div>
</div>
</li>
<li><a id="orgba0a818"></a>Contract State &#x2013; Misc.<br />
<div class="outline-text-5" id="text-1-3-2-5">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_open</span><span style="color: #7d26cd;">()</span> -&gt; <span style="color: #00ff00;">ContractState</span> <span style="color: #7d26cd;">{</span>
    0_u32
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_reserve_0</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">len</span>: <span style="color: #00ff00;">u32</span>, <span style="color: #9acd32;">cur_size</span>: <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">bool</span> <span style="color: #7d26cd;">{</span>
    cur_size &lt; len
<span style="color: #7d26cd;">}</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_reserve_1</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">res</span>: <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">bool</span> <span style="color: #7d26cd;">{</span>
    res == 1_u32
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_truncate_0</span><span style="color: #7d26cd;">(</span><span style="color: #9acd32;">cur_size</span>: <span style="color: #00ff00;">u32</span>, <span style="color: #9acd32;">new_size</span>: <span style="color: #00ff00;">u32</span><span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">bool</span> <span style="color: #7d26cd;">{</span>
    cur_size &gt; new_size
<span style="color: #7d26cd;">}</span>
<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, logic</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_truncate_1</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">current_position</span>: <span style="color: #00ff00;">ContractState</span>,
    <span style="color: #9acd32;">new_size</span>: <span style="color: #00ff00;">u32</span>,
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">ContractState</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">if</span> new_size &lt; current_position <span style="color: #cd0000;">{</span>
        new_size
    <span style="color: #cd0000;">}</span> <span style="color: #b3b3b3;">else</span> <span style="color: #cd0000;">{</span>
        current_position
    <span style="color: #cd0000;">}</span>
<span style="color: #7d26cd;">}</span>

</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orged9fe39" class="outline-4">
<h4 id="orged9fe39"><span class="section-number-4">1.3.3.</span> Parameter</h4>
<div class="outline-text-4" id="text-1-3-3">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">type</span> <span style="color: #00ff00;">Parameter</span> = <span style="color: #00ff00;">u32</span>;

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, trusted</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">read_impl_for_parameter_read</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">current_position</span>: <span style="color: #00ff00;">Parameter</span>,
    <span style="color: #9acd32;">num_read</span>: <span style="color: #00ff00;">u32</span>,
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">Parameter</span>, <span style="color: #00ff00;">usize</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #cd0000;">(</span>current_position + num_read, num_read <span style="color: #b3b3b3;">as</span> <span style="color: #00ff00;">usize</span><span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-orgd6c64f2" class="outline-4">
<h4 id="orgd6c64f2"><span class="section-number-4">1.3.4.</span> AttributesCursor</h4>
<div class="outline-text-4" id="text-1-3-4">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #7f7f7f;">// </span><span style="color: #7f7f7f;">pub struct AttributeTag(pub u8);</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">type</span> <span style="color: #00ff00;">AttributesCursor</span> = <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">u32</span>, <span style="color: #00ff00;">u16</span><span style="color: #7d26cd;">)</span>;

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, trusted</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">has_policy_impl_for_policy_attributes_cursor_next_test</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">policy_attribute_items</span>: <span style="color: #00ff00;">AttributesCursor</span>,
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">bool</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">let</span> <span style="color: #cd0000;">(</span>_, remaining_items<span style="color: #cd0000;">)</span> = policy_attribute_items;
    remaining_items == 0_u16
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, trusted</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">has_policy_impl_for_policy_attributes_cursor_next_tag_invalid</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">policy_attribute_items</span>: <span style="color: #00ff00;">AttributesCursor</span>,
    <span style="color: #9acd32;">tag_value_len_1</span>: <span style="color: #00ff00;">u8</span>,
    <span style="color: #9acd32;">num_read</span>: <span style="color: #00ff00;">u32</span>,
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">AttributesCursor</span>, <span style="color: #00ff00;">bool</span><span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">let</span> <span style="color: #cd0000;">(</span>current_position, remaining_items<span style="color: #cd0000;">)</span> = policy_attribute_items;
    <span style="color: #b3b3b3;">let</span> <span style="color: #9acd32;">policy_attribute_items</span> = <span style="color: #cd0000;">(</span>current_position + num_read, remaining_items<span style="color: #cd0000;">)</span>;
    <span style="color: #cd0000;">(</span>policy_attribute_items, tag_value_len_1 &gt; 31_u8<span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>

<span style="color: #4169e1;">#</span><span style="color: #7d26cd;">[</span><span style="color: #4169e1;">cfg_attr</span><span style="color: #cd0000;">(</span><span style="color: #4169e1;">feature = </span><span style="color: #bdb76b;">"creusot"</span><span style="color: #4169e1;">, trusted</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">]</span>
<span style="color: #b3b3b3;">pub</span> <span style="color: #b3b3b3;">fn</span> <span style="color: #00ffff;">has_policy_impl_for_policy_attributes_cursor_next</span><span style="color: #7d26cd;">(</span>
    <span style="color: #9acd32;">policy_attribute_items</span>: <span style="color: #00ff00;">AttributesCursor</span>,
    <span style="color: #9acd32;">num_read</span>: <span style="color: #00ff00;">u32</span>,
<span style="color: #7d26cd;">)</span> -&gt; <span style="color: #00ff00;">AttributesCursor</span> <span style="color: #7d26cd;">{</span>
    <span style="color: #b3b3b3;">let</span> <span style="color: #cd0000;">(</span>current_position, remaining_items<span style="color: #cd0000;">)</span> = policy_attribute_items;
    <span style="color: #cd0000;">(</span>current_position + num_read, remaining_items - 1_u16<span style="color: #cd0000;">)</span>
<span style="color: #7d26cd;">}</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgbf4a7f1" class="outline-3">
<h3 id="orgbf4a7f1"><span class="section-number-3">1.4.</span> Rust Tests</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">
<pre class="src src-rust">
</pre>
</div>
</div>
</div>

<div id="outline-container-orgadc6d21" class="outline-3">
<h3 id="orgadc6d21"><span class="section-number-3">1.5.</span> Resulting output</h3>
<div class="outline-text-3" id="text-1-5">
<div class="org-src-container">
<pre class="src src-sh">cargo clean
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b0c4de;">cd</span> ../.. &amp;&amp; cargo install --path language
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #b0c4de;">cd</span> ../.. &amp;&amp; cargo build
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">cargo hacspec -o ConcordiumImpls.v concordium_impls --init
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">cargo hacspec -o ConcordiumImpls.v concordium_impls --update
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff24c33" class="outline-3">
<h3 id="orgff24c33"><span class="section-number-3">1.6.</span> Generation of backend output</h3>
<div class="outline-text-3" id="text-1-6">
</div>
<div id="outline-container-org38ab639" class="outline-4">
<h4 id="org38ab639"><span class="section-number-4">1.6.1.</span> The includes</h4>
<div class="outline-text-4" id="text-1-6-1">
<div class="org-src-container">
<pre class="src src-coq"><span style="color: light orange;">(** This file was automatically generated using Hacspec **)</span>
<span style="color: #b3b3b3; text-decoration: underline;">Require Import</span> Lib MachineIntegers.
<span style="color: #b3b3b3;">From</span> Coq <span style="color: #b3b3b3; text-decoration: underline;">Require Import</span> ZArith.
<span style="color: #b3b3b3;">Import</span> List.ListNotations.
<span style="color: #b3b3b3;">Open Scope</span> Z_scope.
<span style="color: #b3b3b3;">Open Scope</span> bool_scope.
<span style="color: #b3b3b3;">Open Scope</span> hacspec_scope.
<span style="color: #b3b3b3; text-decoration: underline;">Require Import</span> Hacspec.Lib.

</pre>
</div>
</div>
</div>

<div id="outline-container-org427d530" class="outline-4">
<h4 id="org427d530"><span class="section-number-4">1.6.2.</span> Types and default implementations</h4>
<div class="outline-text-4" id="text-1-6-2">
<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Notation</span> <span style="color: #bdb76b;">"'reject'"</span> := <span style="color: #7d26cd;">(</span>int32<span style="color: #7d26cd;">)</span> : hacspec_scope.

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">reject_impl_deafult</span>  : reject :=
  min.

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Notation</span> <span style="color: #bdb76b;">"'option_reject'"</span> := <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>option reject<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span> : hacspec_scope.

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">new_reject_impl</span> <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">x_0</span> : int32<span style="color: #7d26cd;">)</span> : option_reject :=
  <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">if</span> <span style="color: #cd0000;">(</span><span style="color: #cd8500;">(</span>x_0<span style="color: #cd8500;">)</span> &lt;.? <span style="color: #cd8500;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 0<span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span>:bool <span style="color: #00ff00;">then</span> <span style="color: #cd0000;">(</span><span style="color: #87ceeb;">@</span>Some reject <span style="color: #cd8500;">(</span>x_0<span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span> <span style="color: #00ff00;">else</span> <span style="color: #cd0000;">(</span>
      <span style="color: #87ceeb;">@</span>None int32<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>.

</pre>
</div>
</div>
</div>

<div id="outline-container-orga7ee377" class="outline-4">
<h4 id="orga7ee377"><span class="section-number-4">1.6.3.</span> Error handling</h4>
<div class="outline-text-4" id="text-1-6-3">
<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">reject_impl_convert_from_unit</span>  : reject :=
  <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 1<span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Theorem</span> <span style="color: #00ffff;">ensures_reject_impl_convert_from_unit</span> : <span style="color: #00ff00;">forall</span> <span style="color: #9acd32;">result_1</span> ,
<span style="color: #87ceeb;">@</span>reject_impl_convert_from_unit  = result_1 -&gt;
<span style="color: #7d26cd;">(</span>result_1<span style="color: #7d26cd;">)</span> !=.? <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 0<span style="color: #7d26cd;">)</span>.
<span style="color: #b3b3b3;">Proof</span>. 
  <span style="color: #9370db;">intros</span> ; <span style="color: #9370db;">subst</span>.
  <span style="color: #ff0000;">reflexivity</span>.
<span style="color: #b3b3b3;">Qed</span>.


</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">reject_impl_convert_from_parse_error</span>  : reject :=
  <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 2<span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Theorem</span> <span style="color: #00ffff;">ensures_reject_impl_convert_from_parse_error</span> : <span style="color: #00ff00;">forall</span> <span style="color: #9acd32;">result_1</span> ,
<span style="color: #87ceeb;">@</span>reject_impl_convert_from_parse_error  = result_1 -&gt;
<span style="color: #7d26cd;">(</span>result_1<span style="color: #7d26cd;">)</span> !=.? <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 0<span style="color: #7d26cd;">)</span>.
<span style="color: #b3b3b3;">Proof</span>. 
  <span style="color: #9370db;">intros</span> ; <span style="color: #9370db;">subst</span>.
  <span style="color: #ff0000;">reflexivity</span>.
<span style="color: #b3b3b3;">Qed</span>.

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Inductive</span> <span style="color: #00ffff;">log_error</span> :=
| Full : log_error
| Malformed : log_error.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">reject_impl_from_log_error</span> <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">le_2</span> : log_error<span style="color: #7d26cd;">)</span> : reject :=
  <span style="color: #00ff00;">match</span> le_2 <span style="color: #00ff00;">with</span>
  | Full =&gt; <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 3<span style="color: #7d26cd;">)</span>
  | Malformed =&gt; <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 4<span style="color: #7d26cd;">)</span>
  <span style="color: #00ff00;">end</span>.

<span style="color: #b3b3b3;">Theorem</span> <span style="color: #00ffff;">ensures_reject_impl_from_log_error</span> : <span style="color: #00ff00;">forall</span> result_1 <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">le_2</span> : log_error<span style="color: #7d26cd;">)</span>,
<span style="color: #87ceeb;">@</span>reject_impl_from_log_error le_2 = result_1 -&gt;
<span style="color: #7d26cd;">(</span>result_1<span style="color: #7d26cd;">)</span> !=.? <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 0<span style="color: #7d26cd;">)</span>.
<span style="color: #b3b3b3;">Proof</span>.  
  <span style="color: #9370db;">intros</span> ; <span style="color: #9370db;">subst</span>.
  <span style="color: #9370db;">destruct</span> le_2 ; <span style="color: #ff0000;">reflexivity</span>.
<span style="color: #b3b3b3;">Qed</span>.

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Inductive</span> <span style="color: #00ffff;">new_contract_name_error</span> :=
| NewContractNameErrorMissingInitPrefix : new_contract_name_error
| NewContractNameErrorTooLong : new_contract_name_error
| NewContractNameErrorContainsDot : new_contract_name_error
| NewContractNameErrorInvalidCharacters : new_contract_name_error.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">reject_impl_from_new_contract_name_error</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">nre_3</span> : new_contract_name_error<span style="color: #7d26cd;">)</span>
  : reject :=
  <span style="color: #00ff00;">match</span> nre_3 <span style="color: #00ff00;">with</span>
  | NewContractNameErrorMissingInitPrefix =&gt; <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 5<span style="color: #7d26cd;">)</span>
  | NewContractNameErrorTooLong =&gt; <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 6<span style="color: #7d26cd;">)</span>
  | NewContractNameErrorContainsDot =&gt; <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 9<span style="color: #7d26cd;">)</span>
  | NewContractNameErrorInvalidCharacters =&gt; <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 10<span style="color: #7d26cd;">)</span>
  <span style="color: #00ff00;">end</span>.

<span style="color: #b3b3b3;">Theorem</span> <span style="color: #00ffff;">ensures_reject_impl_from_new_contract_name_error</span> : <span style="color: #00ff00;">forall</span> result_1 <span style="color: #7d26cd;">(</span>
  <span style="color: #9acd32;">nre_3</span> : new_contract_name_error<span style="color: #7d26cd;">)</span>,
<span style="color: #87ceeb;">@</span>reject_impl_from_new_contract_name_error nre_3 = result_1 -&gt;
<span style="color: #7d26cd;">(</span>result_1<span style="color: #7d26cd;">)</span> !=.? <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 0<span style="color: #7d26cd;">)</span>.
<span style="color: #b3b3b3;">Proof</span>. 
  <span style="color: #9370db;">intros</span> ; <span style="color: #9370db;">subst</span>.
  <span style="color: #9370db;">destruct</span> nre_3 ; <span style="color: #ff0000;">reflexivity</span>.
<span style="color: #b3b3b3;">Qed</span>.

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Inductive</span> <span style="color: #00ffff;">new_receive_name_error</span> :=
| NewReceiveNameErrorMissingDotSeparator : new_receive_name_error
| NewReceiveNameErrorTooLong : new_receive_name_error
| NewReceiveNameErrorInvalidCharacters : new_receive_name_error.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">reject_impl_from_new_receive_name_error</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">nre_4</span> : new_receive_name_error<span style="color: #7d26cd;">)</span>
  : reject :=
  <span style="color: #00ff00;">match</span> nre_4 <span style="color: #00ff00;">with</span>
  | NewReceiveNameErrorMissingDotSeparator =&gt; <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 7<span style="color: #7d26cd;">)</span>
  | NewReceiveNameErrorTooLong =&gt; <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 8<span style="color: #7d26cd;">)</span>
  | NewReceiveNameErrorInvalidCharacters =&gt; <span style="color: #7d26cd;">(</span>min<span style="color: #7d26cd;">)</span> .+ <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 11<span style="color: #7d26cd;">)</span>
  <span style="color: #00ff00;">end</span>.

<span style="color: #b3b3b3;">Theorem</span> <span style="color: #00ffff;">ensures_reject_impl_from_new_receive_name_error</span> : <span style="color: #00ff00;">forall</span> result_1 <span style="color: #7d26cd;">(</span>
  <span style="color: #9acd32;">nre_4</span> : new_receive_name_error<span style="color: #7d26cd;">)</span>,
<span style="color: #87ceeb;">@</span>reject_impl_from_new_receive_name_error nre_4 = result_1 -&gt;
<span style="color: #7d26cd;">(</span>result_1<span style="color: #7d26cd;">)</span> !=.? <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 0<span style="color: #7d26cd;">)</span>.
<span style="color: #b3b3b3;">Proof</span>.
  <span style="color: #9370db;">intros</span> ; <span style="color: #9370db;">subst</span>.
  <span style="color: #9370db;">destruct</span> nre_4 ; <span style="color: #ff0000;">reflexivity</span>.
<span style="color: #b3b3b3;">Qed</span>.

</pre>
</div>
</div>
</div>

<div id="outline-container-org460e005" class="outline-4">
<h4 id="org460e005"><span class="section-number-4">1.6.4.</span> Contract state</h4>
<div class="outline-text-4" id="text-1-6-4">
<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Notation</span> <span style="color: #bdb76b;">"'contract_state'"</span> := <span style="color: #7d26cd;">(</span>int32<span style="color: #7d26cd;">)</span> : hacspec_scope.

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Notation</span> <span style="color: #bdb76b;">"'seek_result'"</span> := <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>result <span style="color: #cd8500;">(</span>contract_state &#215; int64
  <span style="color: #cd8500;">)</span> unit<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span> : hacspec_scope.

<span style="color: #b3b3b3;">Inductive</span> <span style="color: #00ffff;">seek_from</span> :=
| Start : int64 -&gt; seek_from
| <span style="color: #b3b3b3;">End</span> : int64 -&gt; seek_from
| Current : int64 -&gt; seek_from.

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Notation</span> <span style="color: #bdb76b;">"'uint32_option'"</span> := <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>option int32<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span> : hacspec_scope.

<span style="color: #b3b3b3;">Notation</span> <span style="color: #bdb76b;">"'iint64_option'"</span> := <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>option int64<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span> : hacspec_scope.

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">contract_state_impl_seek</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position_5</span> : contract_state<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">pos_6</span> : seek_from<span style="color: #7d26cd;">)</span>
  `<span style="color: #7d26cd;">{</span><span style="color: #00ff00;">forall</span> <span style="color: #9acd32;">delta_7</span> : int64,
  pos_6 = <span style="color: #b3b3b3;">End</span> <span style="color: #cd0000;">(</span>delta_7<span style="color: #cd0000;">)</span> -&gt;
  <span style="color: #9370db;">exists</span> <span style="color: #9acd32;">b_8</span> : int32,
  <span style="color: #cd0000;">(</span>pub_uint32_checked_add <span style="color: #cd8500;">(</span>current_position_5<span style="color: #cd8500;">)</span> <span style="color: #cd8500;">(</span><span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #cdcd00;">(</span>
        delta_7<span style="color: #cdcd00;">)</span><span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span> =.? <span style="color: #cd0000;">(</span><span style="color: #87ceeb;">@</span>Some int32 <span style="color: #cd8500;">(</span>b_8<span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">}</span>
  : seek_result :=
  <span style="color: #00ff00;">match</span> pos_6 <span style="color: #00ff00;">with</span>
  | Start offset_9 =&gt; <span style="color: #87ceeb;">@</span>Ok <span style="color: #7d26cd;">(</span>contract_state &#215; int64<span style="color: #7d26cd;">)</span> unit <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>
      <span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #cd8500;">(</span>offset_9<span style="color: #cd8500;">)</span>,
      offset_9
    <span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>
  | <span style="color: #b3b3b3;">End</span> delta_10 =&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">if</span> <span style="color: #cd0000;">(</span><span style="color: #cd8500;">(</span>delta_10<span style="color: #cd8500;">)</span> &gt;=.? <span style="color: #cd8500;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE64 0<span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span>:bool <span style="color: #00ff00;">then</span> <span style="color: #cd0000;">(</span>
      <span style="color: #00ff00;">match</span> pub_uint32_checked_add <span style="color: #cd8500;">(</span>current_position_5<span style="color: #cd8500;">)</span> <span style="color: #cd8500;">(</span><span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #cdcd00;">(</span>
          delta_10<span style="color: #cdcd00;">)</span><span style="color: #cd8500;">)</span> <span style="color: #00ff00;">with</span>
      | Some b_11 =&gt; <span style="color: #87ceeb;">@</span>Ok <span style="color: #cd8500;">(</span>contract_state &#215; int64<span style="color: #cd8500;">)</span> unit <span style="color: #cd8500;">(</span><span style="color: #cdcd00;">(</span>
          b_11,
          <span style="color: #87ceeb;">@</span>cast _ uint64 _ <span style="color: #00cd00;">(</span>delta_10<span style="color: #00cd00;">)</span>
        <span style="color: #cdcd00;">)</span><span style="color: #cd8500;">)</span>
      | None =&gt; <span style="color: #87ceeb;">@</span>Err <span style="color: #cd8500;">(</span>contract_state &#215; int64<span style="color: #cd8500;">)</span> unit <span style="color: #cd8500;">(</span>tt<span style="color: #cd8500;">)</span>
      <span style="color: #00ff00;">end</span><span style="color: #cd0000;">)</span> <span style="color: #00ff00;">else</span> <span style="color: #cd0000;">(</span><span style="color: #00ff00;">match</span> pub_int64_checked_abs <span style="color: #cd8500;">(</span>delta_10<span style="color: #cd8500;">)</span> <span style="color: #00ff00;">with</span>
      | Some b_12 =&gt; <span style="color: #87ceeb;">@</span>Ok <span style="color: #cd8500;">(</span>contract_state &#215; int64<span style="color: #cd8500;">)</span> unit <span style="color: #cd8500;">(</span><span style="color: #cdcd00;">(</span>
          <span style="color: #00cd00;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 4<span style="color: #00cd00;">)</span> .- <span style="color: #00cd00;">(</span><span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #00cdcd;">(</span>b_12<span style="color: #00cdcd;">)</span><span style="color: #00cd00;">)</span>,
          <span style="color: #87ceeb;">@</span>cast _ uint64 _ <span style="color: #00cd00;">(</span><span style="color: #00cdcd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 4<span style="color: #00cdcd;">)</span> .- <span style="color: #00cdcd;">(</span><span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #0000cd;">(</span>b_12<span style="color: #0000cd;">)</span><span style="color: #00cdcd;">)</span><span style="color: #00cd00;">)</span>
        <span style="color: #cdcd00;">)</span><span style="color: #cd8500;">)</span>
      | None =&gt; <span style="color: #87ceeb;">@</span>Err <span style="color: #cd8500;">(</span>contract_state &#215; int64<span style="color: #cd8500;">)</span> unit <span style="color: #cd8500;">(</span>tt<span style="color: #cd8500;">)</span>
      <span style="color: #00ff00;">end</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>
  | Current delta_13 =&gt; <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">if</span> <span style="color: #cd0000;">(</span><span style="color: #cd8500;">(</span>delta_13<span style="color: #cd8500;">)</span> &gt;=.? <span style="color: #cd8500;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE64 0<span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span>:bool <span style="color: #00ff00;">then</span> <span style="color: #cd0000;">(</span>
      <span style="color: #00ff00;">match</span> pub_uint32_checked_add <span style="color: #cd8500;">(</span>current_position_5<span style="color: #cd8500;">)</span> <span style="color: #cd8500;">(</span><span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #cdcd00;">(</span>
          delta_13<span style="color: #cdcd00;">)</span><span style="color: #cd8500;">)</span> <span style="color: #00ff00;">with</span>
      | Some offset_14 =&gt; <span style="color: #87ceeb;">@</span>Ok <span style="color: #cd8500;">(</span>contract_state &#215; int64<span style="color: #cd8500;">)</span> unit <span style="color: #cd8500;">(</span><span style="color: #cdcd00;">(</span>
          offset_14,
          <span style="color: #87ceeb;">@</span>cast _ uint64 _ <span style="color: #00cd00;">(</span>offset_14<span style="color: #00cd00;">)</span>
        <span style="color: #cdcd00;">)</span><span style="color: #cd8500;">)</span>
      | None =&gt; <span style="color: #87ceeb;">@</span>Err <span style="color: #cd8500;">(</span>contract_state &#215; int64<span style="color: #cd8500;">)</span> unit <span style="color: #cd8500;">(</span>tt<span style="color: #cd8500;">)</span>
      <span style="color: #00ff00;">end</span><span style="color: #cd0000;">)</span> <span style="color: #00ff00;">else</span> <span style="color: #cd0000;">(</span><span style="color: #00ff00;">match</span> pub_int64_checked_abs <span style="color: #cd8500;">(</span>delta_13<span style="color: #cd8500;">)</span> <span style="color: #00ff00;">with</span>
      | Some b_15 =&gt; <span style="color: #00ff00;">match</span> pub_uint32_checked_sub <span style="color: #cd8500;">(</span>current_position_5<span style="color: #cd8500;">)</span> <span style="color: #cd8500;">(</span>
        <span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #cdcd00;">(</span>b_15<span style="color: #cdcd00;">)</span><span style="color: #cd8500;">)</span> <span style="color: #00ff00;">with</span>
      | Some offset_16 =&gt; <span style="color: #87ceeb;">@</span>Ok <span style="color: #cd8500;">(</span>contract_state &#215; int64<span style="color: #cd8500;">)</span> unit <span style="color: #cd8500;">(</span><span style="color: #cdcd00;">(</span>
          offset_16,
          <span style="color: #87ceeb;">@</span>cast _ uint64 _ <span style="color: #00cd00;">(</span>offset_16<span style="color: #00cd00;">)</span>
        <span style="color: #cdcd00;">)</span><span style="color: #cd8500;">)</span>
      | None =&gt; <span style="color: #87ceeb;">@</span>Err <span style="color: #cd8500;">(</span>contract_state &#215; int64<span style="color: #cd8500;">)</span> unit <span style="color: #cd8500;">(</span>tt<span style="color: #cd8500;">)</span>
      <span style="color: #00ff00;">end</span>
      | None =&gt; <span style="color: #87ceeb;">@</span>Err <span style="color: #cd8500;">(</span>contract_state &#215; int64<span style="color: #cd8500;">)</span> unit <span style="color: #cd8500;">(</span>tt<span style="color: #cd8500;">)</span>
      <span style="color: #00ff00;">end</span><span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>
  <span style="color: #00ff00;">end</span>.

</pre>
</div>
</div>

<ol class="org-ol">
<li><a id="org20983d5"></a>Contract state - Read Trait<br />
<div class="outline-text-5" id="text-1-6-4-1">
<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">load_state_hacspec</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">buf_17</span> : public_byte_seq<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">offset_18</span> : int32<span style="color: #7d26cd;">)</span>
  : <span style="color: #7d26cd;">(</span>public_byte_seq &#215; int32<span style="color: #7d26cd;">)</span> :=
  <span style="color: #7d26cd;">(</span>buf_17, <span style="color: #87ceeb;">@</span>repr WORDSIZE32 1<span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Theorem</span> <span style="color: #00ffff;">ensures_load_state_hacspec</span> : <span style="color: #00ff00;">forall</span> result_1 <span style="color: #7d26cd;">(</span>
  <span style="color: #9acd32;">buf_17</span> : public_byte_seq<span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">offset_18</span> : int32<span style="color: #7d26cd;">)</span>,
<span style="color: #87ceeb;">@</span>load_state_hacspec buf_17 offset_18 = result_1 -&gt;
<span style="color: #7d26cd;">(</span>result_1<span style="color: #7d26cd;">)</span> !=.? <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>buf_17, <span style="color: #87ceeb;">@</span>repr WORDSIZE32 2<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>.
<span style="color: #b3b3b3;">Proof</span>.
  <span style="color: #9370db;">intros</span> ; <span style="color: #9370db;">subst</span>.
  <span style="color: #9370db;">unfold</span> negb.
  <span style="color: #9370db;">cbn</span>.
  <span style="color: #9370db;">rewrite</span> list_eqdec_refl.
  <span style="color: #9370db;">cbn</span>.
  <span style="color: #9370db;">rewrite</span> <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>eq_false WORDSIZE32 <span style="color: #cd0000;">(</span>repr 1<span style="color: #cd0000;">)</span> <span style="color: #cd0000;">(</span>repr 2<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span> ; <span style="color: #ff0000;">easy</span>.
<span style="color: #b3b3b3;">Qed</span>.  

</pre>
</div>

<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">contract_state_impl_read_read</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position_19</span> : contract_state<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">buf_20</span> : public_byte_seq<span style="color: #7d26cd;">)</span>
  : <span style="color: #7d26cd;">(</span>contract_state &#215; uint_size<span style="color: #7d26cd;">)</span> :=
  <span style="color: #00ff00;">let</span> '<span style="color: #7d26cd;">(</span>buf_21, num_read_22<span style="color: #7d26cd;">)</span> :=
    load_state_hacspec <span style="color: #7d26cd;">(</span>buf_20<span style="color: #7d26cd;">)</span> <span style="color: #7d26cd;">(</span>current_position_19<span style="color: #7d26cd;">)</span> <span style="color: #00ff00;">in</span> 
  <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>current_position_19<span style="color: #cd0000;">)</span> .+ <span style="color: #cd0000;">(</span>num_read_22<span style="color: #cd0000;">)</span>, <span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #cd0000;">(</span>num_read_22<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">contract_state_impl_read_read_u64</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position_23</span> : contract_state<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">num_read_24</span> : int32<span style="color: #7d26cd;">)</span>
  : <span style="color: #7d26cd;">(</span>contract_state &#215; bool<span style="color: #7d26cd;">)</span> :=
  <span style="color: #7d26cd;">(</span>
    <span style="color: #cd0000;">(</span>current_position_23<span style="color: #cd0000;">)</span> .+ <span style="color: #cd0000;">(</span>num_read_24<span style="color: #cd0000;">)</span>,
    <span style="color: #cd0000;">(</span>num_read_24<span style="color: #cd0000;">)</span> =.? <span style="color: #cd0000;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 8<span style="color: #cd0000;">)</span>
  <span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">contract_state_impl_read_read_u32</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position_25</span> : contract_state<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">num_read_26</span> : int32<span style="color: #7d26cd;">)</span>
  : <span style="color: #7d26cd;">(</span>contract_state &#215; bool<span style="color: #7d26cd;">)</span> :=
  <span style="color: #7d26cd;">(</span>
    <span style="color: #cd0000;">(</span>current_position_25<span style="color: #cd0000;">)</span> .+ <span style="color: #cd0000;">(</span>num_read_26<span style="color: #cd0000;">)</span>,
    <span style="color: #cd0000;">(</span>num_read_26<span style="color: #cd0000;">)</span> =.? <span style="color: #cd0000;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 4<span style="color: #cd0000;">)</span>
  <span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">contract_state_impl_read_read_u8</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position_27</span> : contract_state<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">num_read_28</span> : int32<span style="color: #7d26cd;">)</span>
  : <span style="color: #7d26cd;">(</span>contract_state &#215; bool<span style="color: #7d26cd;">)</span> :=
  <span style="color: #7d26cd;">(</span>
    <span style="color: #cd0000;">(</span>current_position_27<span style="color: #cd0000;">)</span> .+ <span style="color: #cd0000;">(</span>num_read_28<span style="color: #cd0000;">)</span>,
    <span style="color: #cd0000;">(</span>num_read_28<span style="color: #cd0000;">)</span> =.? <span style="color: #cd0000;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 1<span style="color: #cd0000;">)</span>
  <span style="color: #7d26cd;">)</span>.

</pre>
</div>
</div>
</li>

<li><a id="org47e5f62"></a>Contract state - Write Trait<br />
<div class="outline-text-5" id="text-1-6-4-2">
<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">write_impl_for_contract_state_test</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position_29</span> : contract_state<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">len_30</span> : int32<span style="color: #7d26cd;">)</span>
  : bool :=
  option_is_none <span style="color: #7d26cd;">(</span>pub_uint32_checked_add <span style="color: #cd0000;">(</span>current_position_29<span style="color: #cd0000;">)</span> <span style="color: #cd0000;">(</span>len_30<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">write_impl_for_contract_state</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position_31</span> : contract_state<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">num_bytes_32</span> : int32<span style="color: #7d26cd;">)</span>
  : <span style="color: #7d26cd;">(</span>contract_state &#215; uint_size<span style="color: #7d26cd;">)</span> :=
  <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>current_position_31<span style="color: #cd0000;">)</span> .+ <span style="color: #cd0000;">(</span>num_bytes_32<span style="color: #cd0000;">)</span>, <span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #cd0000;">(</span>num_bytes_32<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>.

</pre>
</div>
</div>
</li>

<li><a id="org4f9b76e"></a>Contract State - Misc.<br />
<div class="outline-text-5" id="text-1-6-4-3">
<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_open</span>  : contract_state :=
  <span style="color: #87ceeb;">@</span>repr WORDSIZE32 0.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_reserve_0</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">len_33</span> : int32<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">cur_size_34</span> : int32<span style="color: #7d26cd;">)</span>
  : bool :=
  <span style="color: #7d26cd;">(</span>cur_size_34<span style="color: #7d26cd;">)</span> &lt;.? <span style="color: #7d26cd;">(</span>len_33<span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_reserve_1</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">res_35</span> : int32<span style="color: #7d26cd;">)</span>
  : bool :=
  <span style="color: #7d26cd;">(</span>res_35<span style="color: #7d26cd;">)</span> =.? <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE32 1<span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_truncate_0</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">cur_size_36</span> : int32<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">new_size_37</span> : int32<span style="color: #7d26cd;">)</span>
  : bool :=
  <span style="color: #7d26cd;">(</span>cur_size_36<span style="color: #7d26cd;">)</span> &gt;.? <span style="color: #7d26cd;">(</span>new_size_37<span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">has_contract_state_impl_for_contract_state_truncate_1</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position_38</span> : contract_state<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">new_size_39</span> : int32<span style="color: #7d26cd;">)</span>
  : contract_state :=
  <span style="color: #7d26cd;">(</span><span style="color: #00ff00;">if</span> <span style="color: #cd0000;">(</span><span style="color: #cd8500;">(</span>new_size_39<span style="color: #cd8500;">)</span> &lt;.? <span style="color: #cd8500;">(</span>current_position_38<span style="color: #cd8500;">)</span><span style="color: #cd0000;">)</span>:bool <span style="color: #00ff00;">then</span> <span style="color: #cd0000;">(</span>new_size_39<span style="color: #cd0000;">)</span> <span style="color: #00ff00;">else</span> <span style="color: #cd0000;">(</span>
      current_position_38<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>.

</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org4a6120a" class="outline-4">
<h4 id="org4a6120a"><span class="section-number-4">1.6.5.</span> Parameter</h4>
<div class="outline-text-4" id="text-1-6-5">
<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Notation</span> <span style="color: #bdb76b;">"'parameter'"</span> := <span style="color: #7d26cd;">(</span>int32<span style="color: #7d26cd;">)</span> : hacspec_scope.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">read_impl_for_parameter_read</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">current_position_40</span> : parameter<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">num_read_41</span> : int32<span style="color: #7d26cd;">)</span>
  : <span style="color: #7d26cd;">(</span>parameter &#215; uint_size<span style="color: #7d26cd;">)</span> :=
  <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>current_position_40<span style="color: #cd0000;">)</span> .+ <span style="color: #cd0000;">(</span>num_read_41<span style="color: #cd0000;">)</span>, <span style="color: #87ceeb;">@</span>cast _ uint32 _ <span style="color: #cd0000;">(</span>num_read_41<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>.

</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd414e3" class="outline-4">
<h4 id="orgbd414e3"><span class="section-number-4">1.6.6.</span> Attributes Cursor</h4>
<div class="outline-text-4" id="text-1-6-6">
<div class="org-src-container">
<pre class="src src-coq"><span style="color: #b3b3b3;">Notation</span> <span style="color: #bdb76b;">"'attributes_cursor'"</span> := <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>int32 &#215; int16<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span> : hacspec_scope.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">has_policy_impl_for_policy_attributes_cursor_next_test</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">policy_attribute_items_42</span> : attributes_cursor<span style="color: #7d26cd;">)</span>
  : bool :=
  <span style="color: #00ff00;">let</span> '<span style="color: #7d26cd;">(</span>_, remaining_items_43<span style="color: #7d26cd;">)</span> :=
    policy_attribute_items_42 <span style="color: #00ff00;">in</span> 
  <span style="color: #7d26cd;">(</span>remaining_items_43<span style="color: #7d26cd;">)</span> =.? <span style="color: #7d26cd;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE16 0<span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">has_policy_impl_for_policy_attributes_cursor_next_tag_invalid</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">policy_attribute_items_44</span> : attributes_cursor<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">tag_value_len_1_45</span> : int8<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">num_read_46</span> : int32<span style="color: #7d26cd;">)</span>
  : <span style="color: #7d26cd;">(</span>attributes_cursor &#215; bool<span style="color: #7d26cd;">)</span> :=
  <span style="color: #00ff00;">let</span> '<span style="color: #7d26cd;">(</span>current_position_47, remaining_items_48<span style="color: #7d26cd;">)</span> :=
    policy_attribute_items_44 <span style="color: #00ff00;">in</span> 
  <span style="color: #00ff00;">let</span> policy_attribute_items_49 : <span style="color: #7d26cd;">(</span>int32 &#215; int16<span style="color: #7d26cd;">)</span> :=
    <span style="color: #7d26cd;">(</span><span style="color: #cd0000;">(</span>current_position_47<span style="color: #cd0000;">)</span> .+ <span style="color: #cd0000;">(</span>num_read_46<span style="color: #cd0000;">)</span>, remaining_items_48<span style="color: #7d26cd;">)</span> <span style="color: #00ff00;">in</span> 
  <span style="color: #7d26cd;">(</span>policy_attribute_items_49, <span style="color: #cd0000;">(</span>tag_value_len_1_45<span style="color: #cd0000;">)</span> &gt;.? <span style="color: #cd0000;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE8 31<span style="color: #cd0000;">)</span><span style="color: #7d26cd;">)</span>.

<span style="color: #b3b3b3;">Definition</span> <span style="color: #00ffff;">has_policy_impl_for_policy_attributes_cursor_next</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">policy_attribute_items_50</span> : attributes_cursor<span style="color: #7d26cd;">)</span>
  <span style="color: #7d26cd;">(</span><span style="color: #9acd32;">num_read_51</span> : int32<span style="color: #7d26cd;">)</span>
  : attributes_cursor :=
  <span style="color: #00ff00;">let</span> '<span style="color: #7d26cd;">(</span>current_position_52, remaining_items_53<span style="color: #7d26cd;">)</span> :=
    policy_attribute_items_50 <span style="color: #00ff00;">in</span> 
  <span style="color: #7d26cd;">(</span>
    <span style="color: #cd0000;">(</span>current_position_52<span style="color: #cd0000;">)</span> .+ <span style="color: #cd0000;">(</span>num_read_51<span style="color: #cd0000;">)</span>,
    <span style="color: #cd0000;">(</span>remaining_items_53<span style="color: #cd0000;">)</span> .- <span style="color: #cd0000;">(</span><span style="color: #87ceeb;">@</span>repr WORDSIZE16 1<span style="color: #cd0000;">)</span>
  <span style="color: #7d26cd;">)</span>.

</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Lasse Letager Hansen</p>
<p class="date">Created: 2022-01-06 Thu 12:23</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
